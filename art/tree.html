
<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>1ONO APPLE — Kirschblüten · NUTOPIA</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="header"><a href="#" id="back">NUTOPIA · ART</a></div>
<canvas id="stage"></canvas>
<div class="caption">Citizen Park — Schwarze Kirsche. Der Wind weht, die Blüten blühen und fallen.</div>
<div class="ui">
  <span>Wind</span><input id="wind" type="range" min="-2" max="2" step="0.01" value="0.6">
  <span>Blüten</span><input id="rate" type="range" min="0" max="1" step="0.01" value="0.6">
  <button id="snap">Bild exportieren</button>
</div>
<script>
const C=document.getElementById('stage');const d=C.getContext('2d');
let W=innerWidth,H=innerHeight;C.width=W;C.height=H;
addEventListener('resize',()=>{W=innerWidth;H=innerHeight;C.width=W;C.height=H;});
// Palette: Schwarzweiß mit hauchzartem Rosa
const PAL={bg:'#0b1220', ground:'#0e1526', tree:'#0b0b0e', branch:'#111217', mist:'rgba(255,255,255,0.04)', petal:'#ffffff', petalPink:'rgba(255,182,193,0.10)', shadow:'#00000055'};
// Parkboden
function ground(){
  const g=d.createLinearGradient(0,0,0,H);
  g.addColorStop(0,PAL.bg); g.addColorStop(1,PAL.ground);
  d.fillStyle=g; d.fillRect(0,0,W,H);
  // Nebelschleier
  d.fillStyle=PAL.mist; for(let i=0;i<5;i++){d.fillRect(0,H*0.55+i*8,W,2)}
}
// Baumgeometrie: Silhouette + rekursive Äste
function drawTree(){
  d.save(); d.translate(W*0.32,H*0.78);
  // Stamm
  d.fillStyle=PAL.tree; d.strokeStyle=PAL.branch; d.lineWidth=2;
  d.beginPath(); d.moveTo(-18,0);
  d.bezierCurveTo(-40,-200,-30,-360,10,-520);
  d.bezierCurveTo(40,-360,30,-200,14,0);
  d.closePath(); d.fill(); d.stroke();
  // Äste (rekursiv, zufällig aber deterministisch via seed)
  const rnd=(s)=>{let x=Math.sin(s)*10000; return x-Math.floor(x);}
  function branch(x,y,len,ang,w,seed){
    if(len<24) return;
    d.save(); d.translate(x,y); d.rotate(ang);
    d.strokeStyle=PAL.branch; d.lineWidth=w; d.beginPath(); d.moveTo(0,0); d.lineTo(0,-len); d.stroke();
    const nx=0, ny=-len;
    const k=0.65+0.1*rnd(seed);
    branch(nx,ny,len*k,ang+(-0.7+1.4*rnd(seed+1)),Math.max(1,w*0.72),seed+3);
    branch(nx,ny,len*(k*0.88),ang+(-0.4+0.8*rnd(seed+7)),Math.max(1,w*0.68),seed+11);
    d.restore();
  }
  branch(6,-520,220,-0.2,4,1);
  branch(0,-420,200,0.4,4,2);
  branch(-8,-480,180,-0.9,3,3);
  branch(12,-360,160,0.7,3,4);
  d.restore();
}
// Blütenblätter Partikelsystem
const windCtl=document.getElementById('wind');
const rateCtl=document.getElementById('rate');
let petals=[], settled=[];
function spawnPetal(){
  const x=W*0.2+Math.random()*W*0.6;
  const y=H*0.1+Math.random()*H*0.4;
  const r=2+Math.random()*3;
  const hueChoice=Math.random()<0.1? 'pink':'white';
  petals.push({x,y,vx:(Math.random()*0.2),vy:0.4+Math.random()*0.6,rot:Math.random()*Math.PI,rr:(-0.03+Math.random()*0.06),r,kind:hueChoice});
}
function stepPetals(dt){
  const wind=parseFloat(windCtl.value);
  for(let i=petals.length-1;i>=0;i--){
    const p=petals[i];
    p.vx+=0.0005*wind;
    p.x+=p.vx*dt*60 + Math.sin(p.rot*2)*0.15;
    p.vy+=0.0008*dt*60;
    p.y+=p.vy*dt*60;
    p.rot+=p.rr*dt*60;
    if(p.y>H*0.82){
      settled.push({x:p.x+Math.random()*4-2,y:H*0.82+Math.random()*2,rot:p.rot,r:p.r,kind:p.kind});
      petals.splice(i,1);
    }
    if(p.x<-20||p.x>W+20||p.y>H+20){petals.splice(i,1);}
  }
  const target=200*parseFloat(rateCtl.value);
  if(petals.length<target){for(let k=0;k<3;k++) spawnPetal();}
  while(settled.length>800) settled.shift();
}
function drawPetal(x,y,r,rot,kind,alpha=1){
  d.save(); d.translate(x,y); d.rotate(rot);
  d.beginPath(); d.moveTo(0,-r);
  d.quadraticCurveTo(r,0,0,r);
  d.quadraticCurveTo(-r,0,0,-r);
  d.closePath();
  d.fillStyle = kind==='pink' ? PAL.petalPink : 'rgba(255,255,255,0.85)';
  d.strokeStyle='rgba(255,255,255,0.25)';
  d.lineWidth=0.6;
  d.globalAlpha=alpha;
  d.fill(); d.stroke(); d.globalAlpha=1;
  d.restore();
}
let last=performance.now();
function frame(now){
  const dt=Math.min(0.033,(now-last)/1000); last=now;
  ground(); drawTree();
  stepPetals(dt);
  for(const s of settled){ drawPetal(s.x,s.y,s.r,s.rot,s.kind,0.9); }
  for(const p of petals){ drawPetal(p.x,p.y,p.r,p.rot,p.kind,0.95); }
  // zarter Boden-Schatten
  d.fillStyle=PAL.shadow; d.fillRect(0,H*0.82,W,2);
  requestAnimationFrame(frame);
}
for(let i=0;i<120;i++) spawnPetal();
requestAnimationFrame(frame);
// Export
document.getElementById('snap').addEventListener('click',()=>{
  const url=C.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download='nutopia_cherry_tree.png'; a.click();
});
document.getElementById('back').addEventListener('click',(e)=>{e.preventDefault(); history.back();});
</script>
</body>
</html>
